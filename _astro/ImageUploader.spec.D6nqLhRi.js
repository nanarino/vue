import{v as R,b as M}from"./runtime-dom.esm-bundler.CncNHXS7.js";import{c as F}from"./close.kqYeXzmu.js";import{_ as L}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{d as E,c as v,o as u,g as y,F as j,j as B,a as o,l as I,p as x,m as b,u as A,b as S,q as O,s as C,v as _,t as V,i as P,x as T,y as z,k as H}from"./runtime-core.esm-bundler.Cjvc9vqI.js";import{m as G}from"./message.CURnrVnq.js";async function N(r){if(r instanceof Blob){const n=URL.createObjectURL(r);return Reflect.set(r,"url",n),Reflect.set(r,g,!1),r}else return r}function q(r){g in r&&r[g]===!1&&(URL.revokeObjectURL(r.url),r[g]=!0)}const K=`<svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="4">\r
<path d="M5 24H43M24 5L24 43" stroke-linecap="butt"></path>\r
</svg>`,J=E({__name:"index",props:b({accept:{default:()=>["image/*"]},limit:{default:1/0},customCreateUrl:{type:Function,default:N},customRevokeUrl:{type:Function,default:q},renderAppendIcon:{type:Function,default:()=>_("i",{innerHTML:K,style:"display: inline-flex"})},renderRemoveIcon:{type:Function,default:()=>_("i",{innerHTML:F,style:"display: inline-flex"})}},{modelValue:{default:()=>[]},modelModifiers:{}}),emits:b(["change","loadError","overLimit"],["update:modelValue"]),setup(r,{expose:n,emit:l}){const e=A(r,"modelValue"),i=r,c=l;function s(a){a.stopPropagation(),a.preventDefault()}async function p(a){if(a.stopPropagation(),a.preventDefault(),e.value.length+(a.dataTransfer?.files?.length||0)>i.limit)return c("overLimit");await m(a.dataTransfer?.files||[])}const d=async a=>Promise.all(Array.from(a).filter(t=>i.accept.filter(h=>new RegExp(h).test(t.type)).length).map(async t=>!("url"in t)||g in t&&t[g]?i.customCreateUrl(t):t)),m=async a=>{const t=await d(a);e.value=[...e.value,...t],await C(),c("change",{images:t,action:"append"})};async function U(a){const t=a.target?.files||[];e.value.length+t.length<=i.limit?await m(t):c("overLimit"),a.target.value=""}async function f(a,t,h){c("loadError",a,t,h)}const k=async a=>{const t=e.value.splice(a,1);e.value=[...e.value],await i.customRevokeUrl(t[0]),await C(),c("change",{images:t,action:"remove"})},w=S(()=>e.value.reduce((a,t)=>a+t.size,0));n({append:m,remove:k,size:w,files_setup_effect:d}),(async function(){await d(e.value)})(),O(async()=>{await Promise.all(e.value.map(i.customRevokeUrl))});const D={images:e,props:i,emit:c,handleDrag:s,handleDrop:p,files_setup_effect:d,append:m,handleInput:U,handleLoadError:f,remove:k,size:w};return Object.defineProperty(D,"__isScriptSetup",{enumerable:!1,value:!0}),D}}),Q={class:"na-image-uploader"},W=["src","onError"],X={class:"na-image-footer"},Y={class:"na-image-footer-content"},Z={class:"na-paragraph","data-ellipsis":"2"},$={class:"na-image-footer-action"},ee=["onClick"],ne=["accept"],ae={class:"icon",style:{"font-size":"48px","pointer-events":"none"}};function te(r,n,l,e,i,c){return u(),v("div",Q,[(u(!0),v(j,null,B(l.modelValue,(s,p)=>y((u(),v("div",{class:"na-image",key:s.url},[o("img",{src:s.url,onDragstart:e.handleDrag,onError:d=>e.handleLoadError(d,s,p)},null,40,W),o("div",X,[o("div",Y,[o("div",Z,V(s.name),1)]),o("div",$,[o("span",{class:"icon na-link",onClick:d=>e.remove(p),style:{"font-size":"22px"}},[(u(),I(x(l.renderRemoveIcon)))],8,ee)])])])),[[R,e.images.length>0]])),128)),y(o("div",{class:"na-image na-input-wrapper",onDrop:n[0]||(n[0]=s=>e.images.length<e.props.limit?e.handleDrop(s):e.handleDrag(s)),onDragenter:e.handleDrag,onDragover:e.handleDrag,"data-primary":""},[o("input",{type:"file",class:"na-input",accept:`${l.accept||"image/*"}`||"image/*",onChange:e.handleInput,multiple:""},null,40,ne),o("span",ae,[(u(),I(x(l.renderAppendIcon)))]),n[1]||(n[1]=o("span",null," 點擊添加或拖拽相片 ",-1))],544),[[R,e.images.length<e.props.limit]])])}const oe=L(J,[["render",te],["__scopeId","data-v-227d9613"]]),g=Symbol("revoked"),se=E({__name:"ImageUploader.spec",setup(r,{expose:n}){n();const l=T([]),e=z("ImageUploaderRef"),i=()=>_("iconify-icon",{icon:"line-md:plus"}),c=()=>_("iconify-icon",{icon:"line-md:remove"}),s=async m=>{console.log(m),console.log(e.value?.size)};(async function(){const f=await(await fetch("/vue/images/IMG_2568.json")).json();f.url&&(f.url=f.url.replace(/^\//,"/vue/")),l.value=[f]})();const p=H(!1),d={imgs:l,ImageUploaderRef:e,renderAppendIcon:i,renderRemoveIcon:c,change:s,hidden:p,get ImageUploader(){return oe},get message(){return G}};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}}),re={style:{display:"contents"}},ie={class:"na-paragraph na-font-mono","data-has-indent":""},le={onsubmit:"return false"},ce={class:"na-form-item"},de={class:"na-input-wrapper"},me={class:"na-switch"};function ue(r,n,l,e,i,c){return u(),v("main",re,[e.hidden?P("",!0):(u(),I(e.ImageUploader,{key:0,modelValue:e.imgs,"onUpdate:modelValue":n[0]||(n[0]=s=>e.imgs=s),limit:9,accept:["image/gif","image/jpeg","image/png"],ref:"ImageUploaderRef",onChange:e.change,"render-append-icon":e.renderAppendIcon,"render-remove-icon":e.renderRemoveIcon,onOverLimit:n[1]||(n[1]=s=>e.message({content:"最多9張",primary:"danger"}))},null,8,["modelValue"])),o("p",ie,V(e.imgs.map(s=>s.name)),1),o("form",le,[o("label",ce,[n[5]||(n[5]=o("span",null,"hidden",-1)),o("div",de,[o("span",me,[y(o("input",{type:"checkbox",class:"na-input","onUpdate:modelValue":n[2]||(n[2]=s=>e.hidden=s),id:"hidden",name:"hidden"},null,512),[[M,e.hidden]]),n[3]||(n[3]=o("i",{class:"na-switch-mover"},null,-1)),n[4]||(n[4]=o("span",{class:"na-switch-slot"},null,-1))])])])])])}const he=L(se,[["render",ue],["__scopeId","data-v-55915d00"]]);export{he as default};
